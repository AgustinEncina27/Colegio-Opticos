<div class="container my-5">
  <h2>Gestión de Matriculados</h2>

  <div class="d-flex gap-2 align-items-start my-3">
    <input
      type="text"
      class="form-control"
      style="max-width: 420px"
      placeholder="Buscar por nombre, DNI o matrícula"
      [(ngModel)]="filtro" />
  
    <button class="btn btn-primary" (click)="buscarMatriculados()">Buscar</button>
    <button class="btn btn-outline-secondary" (click)="limpiarFiltro()" [disabled]="!tieneFiltroActivo">
      Limpiar
    </button>
  
    <div *ngIf="loading" class="ms-2 align-self-center">Buscando...</div>
  
    <button class="btn btn-success ms-auto" (click)="nuevo()">+ Nuevo Matriculado</button>
  </div>
  
  <div class="table-responsive shadow">
    <table class="table table-bordered text-center align-middle">
      <thead class="table-primary">
        <tr>
          <th>Nombre</th>
          <th>Matrícula</th>
          <th>DNI</th>
          <th>Teléfono</th>
          <th>Email</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of listaRender">
          <td>{{ m.nombre }}</td>
          <td>{{ m.matricula }}</td>
          <td>{{ m.dni }}</td>
          <td>{{ m.telefono }}</td>
          <td>{{ m.email }}</td>
          <td>
            <span class="badge" [ngClass]="m.habilitado ? 'bg-success' : 'bg-danger'">
              {{ m.habilitado ? 'Habilitado' : 'Deshabilitado' }}
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-warning me-1" (click)="editar(m)">Editar</button>
            <button *ngIf="m.habilitado" class="btn btn-sm btn-danger me-1" (click)="darDeBaja(m.id)">Dar de baja</button>
            <button *ngIf="!m.habilitado" class="btn btn-sm btn-success me-1" (click)="darDeAlta(m.id)">Dar de alta</button>
            <button class="btn btn-sm btn-outline-danger" (click)="eliminarDefinitivo(m.id)">Eliminar</button>
          </td>
        </tr>
        <tr *ngIf="tieneFiltroActivo && !loading && listaRender.length === 0">
          <td colspan="7" class="text-center text-muted">Sin resultados para “{{ filtroAplicado }}”.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginador: visible solo cuando NO hay filtro activo -->
  <nav *ngIf="totalPaginas > 1 && !tieneFiltroActivo" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="paginaActual === 0">
        <button class="page-link btn" style="color: var(--main-color);" (click)="irPagina(paginaActual - 1)">
          « Anterior
        </button>
      </li>

      <li class="page-item" *ngFor="let i of paginasVisibles" [class.active]="paginaActual === i">
        <button
          class="page-link btn"
          [ngStyle]="{
            'background-color': paginaActual === i ? 'var(--main-color)' : '',
            'color': paginaActual === i ? 'white' : ''
          }"
          (click)="irPagina(i)">
          {{ i + 1 }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="paginaActual + 1 === totalPaginas">
        <button class="page-link btn" style="color: var(--main-color);" (click)="irPagina(paginaActual + 1)">
          Siguiente »
        </button>
      </li>
    </ul>
  </nav>
</div>
